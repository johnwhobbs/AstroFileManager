name: Claude Code Issue Fixer

on:
  issues:
    types: [labeled]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  claude-fix:
    if: github.event.label.name == 'claude-fix'
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Run Claude Code
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          additional_permissions: |
            - CreateFile:**
            - StrReplace:**
            - View:**
            - GlobTool:**
            - GrepTool:**
            - BatchTool:**
          claude_args: |
            --max-turns 25
          prompt: |
            Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}
            
            ${{ github.event.issue.body }}
            
            IMPORTANT - HOW TO EXPLORE THE REPOSITORY:
            - To see directory contents, use View tool with just the directory path
            - To read a file, use View tool with the full file path including extension
            - Use GlobTool to find files matching patterns (e.g., "*.py")
            - DO NOT try to read directories as files
            
            TASK:
            Implement the changes described in the issue above for this Python astrophotography application.
            
            CODING GUIDELINES:
            - Write beginner-friendly Python code
            - Add clear comments
            - Include docstrings for functions
            - Add basic error handling
            - Follow PEP 8 style
            
            WORKFLOW:
            1. First explore the repository structure
            2. Understand existing code
            3. Make your changes
            4. The system will automatically create a PR
